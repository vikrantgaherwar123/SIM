<div *ngIf="activeInvoice" class="row main-wrapper">
  <div class="col-12" id="main">
    <div  class="row">
      <div id="msgInv" *ngIf="viewTodaysInvoice == false"
        class="col-12 col-md-9 item-form all-invoices inv-generator inv-gen">
        <form #invoiceGeneratorAdd="ngForm" id="invoiceGeneratorAdd" name="invoiceGenerator" class="create-invoice"
          (ngSubmit)="save(invoiceGeneratorAdd.valid)">
          <div class="back p-4 shadow" style="border-radius: 2px;">
            <div class="col-12">
              <div class="vtop text-right">
                <span class="c-name" type="text" id="titleAdd" name="title">
                  {{settings.mTvInvoice ? settings.mTvInvoice : 'INV_LABEL' | translate}}
                </span>
              </div>

              <div class="col-12 px-0 mb-1">
                <!-- Invoice Details Header -->
                
                <div class="row">
                    <div class="col-sm-6" id="clientDataAdd" name="clientData">
                          <div class="row">
                            <!-- Billing To -->
                            <div class="col-12">
                                <span type="text" value="" id="billToLabelAdd" class="adr bill-to font-custom-bold">
                                  {{settings.mTvBillTo ? settings.mTvBillTo : 'BILL_TO_LABEL' | translate}}
                                </span>
        
                                <div class="input-group pl-0 inputWithIcon">
                                  <input type="text" id="bill-to-input" style="height: 40px !important;" class="form-control billing-input"  placeholder="Search & Select Client"
                                    matInput [formControl]="billingTo" [matAutocomplete]="auto1" *ngIf="!edit" (click)="closeAddClientModal()" [ngClass]="{ 'box_red': noClientSelected ===true }"
                                  >
                                   <i [ngClass]="{ 'hide_dropdown': billingTo.value }" class="filtersubmit"></i>
                                  <i *ngIf="!edit && billingTo.value" (click)="closeAddClientModal()" style="-webkit-text-stroke: 2px white;" class="filtersubmit fa fa-close"></i> 
                                  
                                  <div *ngIf="edit && billingTo.value" class="font-custom-bold">{{billingTo.value.name}}</div>
                                  <mat-autocomplete #auto1="matAutocomplete" class="mCustomScrollbar style-3" [displayWith]="displayWith"
                                    autoActiveFirstOption (optionSelected)="selectedClientChange($event)"  id="style-3"
                                  >
                                    
                                      <button *ngIf="openClientModal === false" (click)="openAddClientModal()"
                                        class="btn btn-primary add_client_btn">
                                        <i class="fa fa-plus"></i>
                                        Add New Client
                                      </button>
                                
                                    <mat-option style="color: #2c3e59" *ngFor="let client of (filteredClients | async | orderBy:'name':false:true)" [value]="client">
                                      {{client.name}}
                                    </mat-option>
                                    <mat-option *ngIf="filteredClients && (filteredClients | async).length == 0" [value]="billingTo.value">
                                      Add Client {{billingTo.value}}
                                    </mat-option>
                                  </mat-autocomplete>
                                </div>
                              </div>
                            
      
                            <!-- <div class="col-2" style="padding-top: 30px;">
                              <span>
                                <i *ngIf="clientListLoading" class="fa fa-spinner fa-spin" style="font-size:24px;"></i>
                              </span>
                            </div> -->
      
                            <!-- Address and Shipping Address -->
                            <div id="addressBarAdd" name="addressBar" class="col-12" style="margin-bottom: 15px;padding-top: 16px;">
                              <div class="row mx-0">
                                <div class="col-6 pl-0">
                                  <span type="text" value="" id="BillAddressAdd" class="adr bill-to font-custom-bold">Address</span><br />
                                  <div class="address-render" *ngIf="activeClient">{{activeClient.addressLine1}}<br /></div>
                                  <div *ngIf="activeClient && activeClient.email">
                                    Email: {{activeClient.email}}
                                  </div>
                                  <div *ngIf="activeClient && activeClient.number">
                                    Contact No: {{activeClient.number}}
                                  </div>
                                </div>
                                <div class="col-6 pr-0">
                                  <span style="padding-left: 45px;" type="text" value="" id="shippingAddressAdd" class="adr bill-to font-custom-bold">
                                   Shipping Address
                                  </span>
                                  <div class="address-render" *ngIf="shippingChange === false">{{shippingAddress}}<br /></div>
                                  <div class="address-render" *ngIf="activeClient && shippingAdressChanged === true">{{activeClient.shippingAddress}}<br /></div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-2"></div>
                    <div class="col-12 col-sm-4" id="estDataAdd">
                      <div class="row"> 
                        <!-- Estimate Number and Dates -->
                        <div class="col-5" style="margin-top: 5px;">
                          <span class="font-custom-bold text-left w-100"> {{settings.mTvInvoice ? settings.mTvInvoice : 'Invoice'}} No.</span>
                        </div>
                        <div class="col-7">
                            <form #invNumberForm="ngForm" name="invNumberForm">
                                <div class="form-group" [class.has-error]="(invNumberForm.submitted || invNumberForm.invoiceNumber )
                                  && invNumberForm.invoiceNumber.$error.required">
                                  <input type="text" id="invoiceNumber" name="invoiceNumber" class="light_font form-control pr-0 input_border_color"
                                    style="margin-top: 0px !important;" [(ngModel)]="activeInvoice.invoice_number"
                                    [ngClass]="{ 'box_red': invoiceFlag === true}" (keyup)="invoiceNoChanged($event)" required
                                    onfocus="this.select()" />
                                  <span *ngIf="activeInvoice.invoice_number === '' " class="fa fa-info-circle errspan"></span>
                                  <!--show error icon if no invoice number-->
                                  <div class="form-error" *ngIf="invNumberForm.submitted || invNumberForm.invoiceNumber">
                                    <span class="span_padng_top" *ngIf="invNumberForm.invoiceNumber.error.required">
                                      {{settings.mTvInvoice ? settings.mTvInvoice : 'Invoice'}} No. required</span>
                                  </div>
                                </div>
                              </form>
                        </div>
                      </div>
      
                      <div class="row">
                        <div class="col-5" style="margin-top: 5px;">
                            <span class="font-custom-bold text-left w-100">
                                {{settings.mTvInvoice ? settings.mTvInvoice : 'Invoice'}} Date</span>
                        </div>
                        <div class="col-7">
                            <div style="max-width: 100%;">
                                <div class="row mx-0">
                                  <input type="text" class="form-control border-hover input_border_color light_font" placeholder="mm/dd/yyyy" required
                                    [formControl]="invoiceDate" matInput [matDatepicker]="picker" (click)="picker.open()"
                                    onfocus="this.select()">
                                  <!-- <input class="form-control" name="formatedDate" [ngModelOptions]="{standalone: true}" matInput [matDatepicker]="picker" (click)="picker.open()"> -->
                                  <mat-datepicker #picker></mat-datepicker>
                                </div>
                              </div>
                              <div class="form-error" *ngIf="invoiceGeneratorAdd.submitted || invoiceGeneratorAdd.touched">
                                  <span class="span_padng_top" *ngIf="invoiceGeneratorAdd.error">{{settings.mTvInvoice}} date
                                    required</span>
                                </div>
                                <input type="hidden" [(ngModel)]="activeInvoice.created_date" name="createdDate" />
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-5" style="margin-top: 5px;">
                          <span class="font-custom-bold text-left w-100">Reference</span>
                        </div>
                        <div class="col-7">
                          <input type="text" id="referenceid" name="invoiceNumber" class="light_font form-control pr-0 input_border_color"
                            [(ngModel)]="activeInvoice.reference" onfocus="this.select()" />
                        </div>
                      </div>
                      <div class="row">
                          <div class="col-5" style="margin-top: 5px;">
                            <span class="font-custom-bold text-left w-100"> Due On</span>
                          </div>
                          <div class="col-7 selectDueDate form-group">
                            <div class="selectdiv">
                              <select name="selectDueDate" id="selectDueDate" [value]="activeInvoice.due_date_flag || 0"
                                class="due_date form-control pr-0 selectDueDate light_font" (change)="changeDueDate($event.target.value)"
                                style="cursor: pointer;margin-top: -0.5px;">
                                <option class="opt" value="0">No Due Date</option>
                                <option class="opt" value="1">Immediately</option>
                                <option class="opt" value="2">Custom Date</option>
                                <option class="opt" value="3">7 Days</option>
                                <option class="opt" value="4">10 Days</option>
                                <option class="opt" value="5">15 Days</option>
                                <option class="opt" value="6">30 Days</option>
                                <option class="opt" value="7">45 Days</option>
                                <option class="opt" value="8">60 Days</option>
                                <option class="opt" value="9">90 Days</option>
                              </select>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                            <div class="col-5" style="margin-top: 5px;">
                              <span class="font-custom-bold text-left w-100"></span>
                            </div>
                            <div class="col-7" *ngIf="activeInvoice.due_date_flag">
                                <div style="margin-top: -3px;" *ngIf="activeInvoice.due_date_flag !== 2">
                                  <div>
                                    <input type="text" name="dueDate" class="form-control input_border_color light_font"
                                      [value]="activeInvoice.due_date | date: 'MM/dd/yyyy'" required readonly>
                                  </div>
                                </div>
                              </div>
                          </div>

                        <div class="row">
                          <div class="col-5" style="margin-top: 5px;">
                            <span class="font-custom-bold text-left w-100"></span>
                          </div>
                          <div class="col-7" *ngIf="activeInvoice.due_date_flag === 2">
                            <div style="margin-top: 3px;">
                              <input type="text" name="dueDate" class="form-control light_font" [formControl]="dueDate" matInput
                                [matDatepicker]="picker1" required readonly (click)="picker1.open()">
                              <mat-datepicker #picker1></mat-datepicker>
                            </div>
                          </div>
                        </div>
                    </div>
                  </div>
                <!-- Items table -->
                <div class="lineItemDiv">
                  <table width="100%" cellpadding="0" cellspacing="0" class="column table table-striped"
                    style="table-layout: fixed">
                    <thead>
                      <tr class="hd">
                        <td width="20%">
                          <input style="margin-left: 10px;" type="text" id="itemLable"
                            class="bld w-100 text-left" disabled
                            value="{{settings.mTvProducts ? settings.mTvProducts : 'PRO_LABEL' | translate}}" />
                        </td>
                        <td width="10%">
                          <input type="text" id="itemQtyLabel"
                            class="bld w-100 text_right" name="quantity" disabled
                            value="{{settings.mTvQty ? settings.mTvQty : 'QTY_LABEL' | translate}}" />
                        </td>
                        <td width="10%">
                          <input type="text" id="itemRateLabel"
                            class="bld w-100 text_right" name="rate" disabled
                            value="{{settings.mTvRate ? settings.mTvRate : 'RATE_LABEL' | translate}}" />
                        </td>
                        <td width="9%"
                          *ngIf="activeInvoice.tax_on_item === 0 "><!--|| showTaxRate!==0 && showTaxRateFlag == true-->
                          <input type="text" id="itemTaxLabel" class="bld w-100 text_right" name="tax-rate" disabled
                            
                            value="Tax (%)"/>
                        </td>
                        <td width="9%"
                          *ngIf=" activeInvoice.discount_on_item == 1 "><!--|| showDiscountRate !==0 && showDiscountRateFlag == true-->
                          <input type="text" id="itemDiscountLabel" class="bld w-100 text_right" name="discount"
                            disabled value="{{settings.discount ? settings.discount : 'Discount'}} (%)"
                            />
                        </td>
                        <td width="9%">
                          <input type="text" id="itemAmtLabelAdd"
                            class="bld w-100 text_right" name="amount" disabled
                            value="{{settings.mTvAmount ? settings.mTvAmount : 'AMT_LABEL' | translate}}" />
                        </td>
                        <td width="5%" class="text-right">Edit</td>
                        <td width="6%" class="last_td">Delete</td>
                      </tr>
                    </thead>

                    <tbody class="lineItems">
                      <!-- selected Items list -->
                      <tr class="row-item"
                        *ngFor="let item of activeInvoice.listItems; let index = index; let last = last">
                        <td [class.no-border-last]="last">
                          <div class="">
                            <div class="form-group" style="margin-bottom: -12px;margin-top: 8px;">
                              <div class="product-color" style="margin-left: 10px;">
                                {{item.product_name}}
                              </div>
                              <div class="moreDiscr" [class.show]="hideme[index]"><!--class="moreDiscr" [class.show]="show"-->
                                <pre class="selected-items selected_description"
                                 >{{item.description}}</pre>
                              </div>
                              <span *ngIf="item.description.length > 90" class="morebtn" (click)="hideme[index] = !hideme[index]">{{ hideme[index] ? 'less': 'more' }}</span>
                            </div>
                          </div>
                        </td>
                        <td [class.no-border-last]="last">
                          <div class="text_right">
                            {{item.quantity | number:'1.'}}
                          </div>
                        </td>
                        <td [class.no-border-last]="last">
                          <div class="text_right">
                            {{item.rate | number:'2.'}}
                          </div>
                        </td>
                        <td *ngIf="activeInvoice.tax_on_item === 0 " [class.no-border-last]="last">
                          <div class="text_right">
                            {{item.tax_rate | number:'2.'}}
                          </div>
                        </td>
                        <td *ngIf="activeInvoice.discount_on_item == 1" [class.no-border-last]="last">
                          <div class="text_right">
                            {{item.discount | number:'2.'}}
                          </div>
                        </td>
                        <td [class.no-border-last]="last" style="position: unset !important;">
                          <div class="text_right">
                            {{item.total | number:'2.'}}
                          </div>
                        </td>
                        <td [class.no-border-last]="last">
                          <div class="text_right">
                            <a class="closeicon show" title="Edit Row"
                              (click)="editInvoiceItem(index);disabledDescription = true">
                              <img src="assets/images/edit_blue.png" class="hg_20 img_hover edit_delete_icon">
                            </a>
                          </div>
                        </td>
                        <td [class.no-border-last]="last">
                          <div class="text_right last_td">
                            <a  title="Delete Row" (click)="removeItem(index)">
                              <img src="assets/images/cross.png" style="margin-right: 7px;" class="hg_20 img_hover edit_delete_icon"
                                >
                            </a>
                          </div>
                        </td>
                      </tr>

                      <!-- Select Item for invoice input -->
                      <tr *ngIf="disableProductText === true" class="row-item item_box_shadow">
                        <td [class.no-border-last]="last">

                          <div class="form-group" style="padding-right: -2px;padding-left: 4px;
                          border-radius: 2px;padding: 4px 2px;">
                            <input type="text" name="product-name" class="mrg_item_input form-control billing-input input_border_color" tabindex="1"
                              onfocus="this.select()" [ngClass]="{ 'box_red': noProductSelected ===true }"
                              placeholder="Type or Select {{settings.mTvProducts ? settings.mTvProducts : 'Product'}}"
                              matInput [formControl]="addItem" [matAutocomplete]="auto" required>
                              <img src="assets/images/product-icon/exclamation-mark.png"  class="errspan help-block" *ngIf="ifProductEmpty === true && addItem !==null">

                            <!-- <span *ngIf="ifProductEmpty === true && addItem !==null"
                              class="fa fa-info-circle errspan help-block"></span> -->

                            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayWith"
                              class="mCustomScrollbar style-3" (optionSelected)="fillItemDetails()">
                              <mat-option
                                *ngFor="let product of (filteredProducts | async | orderBy:'prodName':false:true)"
                                [value]="product">{{product.prodName}}</mat-option>
                            </mat-autocomplete>
                            <div class="custom-description mrg_item_input" style="margin-top: -2px;">
                              <textarea *ngIf="disabledDescription==false" id="descId" tabindex="6"
                                name="description_{{index}}" style="height: 55px !important;"
                                class="txt_area black form-control font_wg_none mCustomScrollbar style-3 invoice_desc" elastic
                                [(ngModel)]="activeItem.description"
                                placeholder="Description" onfocus="this.select()">
                              </textarea>
                              <textarea *ngIf="disabledDescription==true" id="descId" name="description_{{index}}" style="height: 55px !important;"
                                class="txt_area invoice_desc black form-control font_wg_none mCustomScrollbar style-3 mrg_item_input" elastic placeholder="Description"
                                onfocus="this.select()">
                              </textarea>
                            </div>
                          </div>
                        </td> 

                        <td style="vertical-align: top;" [class.no-border-last]="last">
                          <div class="form-group" style="padding: 4px 2px;">
                            <input type="number" name="itemQty" id="qty" step="any" tabindex="2"
                              class="form-control height_40 text_right input_border_color" min="0" [(ngModel)]="activeItem.quantity"
                              (keyup)="calculateTotal()" onfocus="this.select()" required />
                          </div>

                          <button type="button" style="margin-top: 10px;" tabindex="7"
                            class="change_bg btn save_btn btn-raised add_new_btn add_item_mr_discount"
                            (click)="addEditInvoiceItem()">
                            Add Item
                          </button>
                        </td>

                        <td style="vertical-align: top;" [class.no-border-last]="last">
                          <div class="form-group" style="padding: 4px 2px;">
                            <input type="number" name="itemRate" step="any" tabindex="3"
                              class="form-control height_40 text_right input_border_color" min=0 [(ngModel)]="activeItem.rate"
                              (keyup)="calculateTotal()" onfocus="this.select()" required />
                          </div>
                        </td>
                        <td style="vertical-align: top;" [class.no-border-last]="last"
                        *ngIf="noTaxOnItem || activeInvoice.tax_on_item === 0"><!-- || showTaxRate!==0 && showTaxRateFlag == true-->
                          <div class="input-group" style="padding: 4px 2px;">
                            <input type="number" name="itemTaxRate" tabindex="4"
                              class="form-control height_40 text_right input_border_color" min=0 max=100
                              [(ngModel)]="activeItem.tax_rate" (keyup)="calculateTotal()" onfocus="this.select()"
                              placeholder="%" />
                            <!-- <div class="input-group-append">
                              <span class="input-group-text p-0" style="width: 22px;border-left: none;">%</span>
                            </div> -->
                          </div>
                          <!-- <div class="text-right">{{activeItem.tax_amount}}</div> -->
                        </td>
                        <td style="vertical-align: top;" [class.no-border-last]="last"
                        *ngIf="noDiscountOnItem || activeInvoice.discount_on_item == 1"><!--|| showDiscountRate !==0 && showDiscountRateFlag == true -->
                          <div class="input-group" style="padding: 4px 2px;">
                            <input type="number" name="itemDiscountRate" tabindex="5"
                              class="form-control height_40 text_right input_border_color" min=0 max=100 [(ngModel)]="activeItem.discount"
                              (keyup)="calculateTotal()" onfocus="this.select()"
                              placeholder="%" />
                            
                          </div>
                          <!-- <div class="text-right">{{activeItem.discount_amount}}</div>            -->
                        </td>

                        <td style="vertical-align: top; position: relative !important;" [class.no-border-last]="last">
                          <div class="form-group" style="padding: 4px 2px;">
                            <input type="number" step="any" class="form-control height_40 text_right input_border_color" readonly
                              title="{{settings.mTvamount ? settings.mTvAmount : 'Amount'}} calculated automatically."
                              name="itemTotal" [(ngModel)]="activeItem.total"
                              style="border: 0px solid #ced4da !important;background-color: #f2f1f1 !important;"
                              disabled.btn-custom-1 />
                            <!-- <button type="button"  class="btn save_btn btn-raised add_new_btn add_item_mr_discount" (click)="addEditInvoiceItem();"
                          >Add Item
                          </button> -->
                          </div>
                        </td>
                        <td style="vertical-align: top; position: relative !important;" [class.no-border-last]="last">
                          
                        </td>
                        <td class="select_item_cross" [class.no-border-last]="last">
                          <img (click)="disableProductText=false;" Title="Delete" src="assets/images/cross_grey.png" data-tooltip="I’m the tooltip text."
                            alt="logo" style="margin-top: 2px;margin-right: 7px;" class="hg_20 img_hover"><!--assets/images/cross.png-->
                          <!--(click)="activeInvoice.listItems=undefined"-->
                        </td>
                      </tr>
                      <button *ngIf="disableProductText === false" type="button"
                        class="change_bg btn save_btn btn-raised add_new_btn add_new_item" style="width: 130px !important;"
                        (click)="disableProductText=true;ifProductEmpty=false">
                        Add New Item
                      </button>
                    </tbody>
                  </table>
                </div>

                <!-- Tax discount list -->
                <div class="row">
                  <div class="col-12 offset-md-6 col-md-6 discount-tax-pad font-custom-bold"
                    style="padding-bottom: 8px;">
                    <div *ngIf="settings.discountFlagLevel == 0 &&  activeInvoice.discount_on_item===2"> <!-- &&  activeInvoice.discount_on_item===2-->
                      <span class="inline label_span" [ngClass]="{'removeaddLabelBackroundColor':activeInvoice.discount_on_item===2 , 'addLabelBackroundColor':activeInvoice.discount_on_item === 0}"
                        (click)="activeInvoice.discount_on_item = 0 ;activeInvoice.percentage_flag = 0"><!--activeInvoice.percentage_flag = 0;activeInvoice.percentage_value=null;activeInvoice.discount=null-->
                        {{settings.discount ? settings.discount : 'Discount'}} &nbsp;+
                    </span>
                    </div>
                    <div > <!--*ngIf="activeInvoice.shipping_charges === undefined"-->
                      <span class="inline label_span" [ngClass]="{'removeaddLabelBackroundColor':!noShippingCharges , 'addLabelBackroundColor':noShippingCharges}"
                       (click)="activeInvoice.shipping_charges = 0;noShippingCharges = true">
                        <!-- {{settings.shipping ? settings.shipping : 'Shipping'}}+ -->
                        {{settings.shipping ? settings.shipping : 'Shipping'}} &nbsp;+
                      </span>
                    </div>
                    <div><!--*ngIf="showTaxRateFlag === true"-->
                      <div
                        *ngIf="settings.taxFlagLevel == 1"> <!--&& activeInvoice.tax_rate === 0 || activeInvoice.tax_on_item === 2-->
                        <span  class="inline label_span" [ngClass]="{'removeaddLabelBackroundColor':activeInvoice.tax_on_item === 2 , 'addLabelBackroundColor':activeInvoice.tax_on_item === 1}"
                         (click)="activeInvoice.tax_on_item=1;activeInvoice.tax_rate = null">Tax &nbsp;+</span>
                      </div>
                    </div>
                    <div ><!--*ngIf="activeInvoice.adjustment === null || activeInvoice.adjustment === undefined"-->
                      <span class="inline label_span" [ngClass]="{'removeaddLabelBackroundColor':!noAdjustment ,
                       'addLabelBackroundColor':noAdjustment}"
                       (click)="activeInvoice.adjustment = 0;noAdjustment = true">
                        {{settings.adjustment ? settings.adjustment : 'ADJ_LABEL' | translate}} &nbsp;+
                      </span>
                    </div>
                    <div *ngIf="activeInvoice.taxList">
                      <div  *ngFor="let tax of settings.alstTaxName; let taxIndex = index">
                        <span class="inline label_span"[ngClass]="{'removeaddLabelBackroundColor':!activeInvoice.taxList[taxIndex] ,
                        'addLabelBackroundColor':activeInvoice.taxList[taxIndex] }"
                          (click)="activeInvoice.taxList[taxIndex] = {taxName: tax.taxName, calculateValue: tax.calculateValue}">
                          {{tax.taxName}} &nbsp;+
                      </span> <!--*ngIf="!activeInvoice.taxList[taxIndex]"-->
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Bottom -->
                <div class="row">
                  <!--Term and Condition -->
                  <div class="col-12 col-md-6">
                    <div class="col-12 term-cond-label font-custom-bold" style="text-align: left">
                      <span class="bld">
                        {{settings.mTvTermsAndConditions ? settings.mTvTermsAndConditions : 'TERM_LABEL' | translate}}
                      </span>
                      <a (click)="openAddTermModal()" class="pull-right add_term" data-original-title="Add" title="Add Term">
                         <span class="add_term">
                            <i class="fa fa-plus" style="margin-right: 5px;"></i>
                            <span>Add Terms</span>
                         </span>
                      </a>
                    </div>

                    <div class="col-12 px-0" style="font-size: 13px;">
                      <div class="form-group terms_line_height">
                        <div *ngFor="let term of activeInvoice.termsAndConditions" class="row mx-0" style="border-bottom: 1px solid #e9e9e9;padding-top: 0px;">
                          <div *ngIf="term.terms" class="col-12 col-md-10 pr-0 mb-1">
                            <span class="all_terms">{{term.terms}}</span>
                          </div>
                          <div *ngIf="!term.terms" class="col-12 col-md-10 pr-0 mb-1" style="color: #a4a4a4;">
                            <span class="all_terms">{{term.terms_condition}}</span>
                          </div>
                          <div class="col-md-2 ml-auto" (click)="addRemoveTermsFromInvoice(term)"
                            style="cursor:pointer;">
                            <a class="closeicon show float-right">
                              <!-- <img src="assets/images/cross.png" Title="Delete Term" class="img_hover hg_16 del set-color"
                                alt=""> -->
                                    <img src="assets/images/cross_grey.png" Title="Delete Term" class="img_hover del set-color"
                                    alt="">
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Calculations -->
                  <div class="col-12 col-md-6">
                    <!-- Total -->
                    <div class="col-12 term-cond-label" style="margin-bottom: 5px;">
                      <div class="row">
                        <div class="col-6 text-left">
                          <span
                            class="font-custom-bold">{{settings.subtotal ? settings.subtotal : 'SUB_TOT_LABEL' | translate}}</span>
                        </div>
                        <div class="col-6 text-right">
                          <span
                            class="font-custom-bold price">{{activeInvoice.gross_amount | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}</span>
                        </div>
                      </div>
                    </div>

                    <!-- Discounts -->
                    <div class="row mr_right mr_0" *ngIf="activeInvoice.discount_on_item === 0">
                      <div class="col-4 discount-tax-label pr-0">
                        <span style="text-align: left;vertical-align: bottom;">
                          {{settings.discount ? settings.discount : 'Discount'}}
                        </span>
                        <div class="px-0" style="float: right; padding-right: 10px;">
                          <div style="cursor: pointer;" class="dropdown-toggle custom-dropdown " data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            <span class="glyphicon glyphicon-menu-down" style="font-size: 14px;vertical-align: middle;"
                              title="{{settings.discount ? settings.discount : 'Discount'}}"></span>
                          </div>
                          <ul class="dropdown-menu dropdown-menu-right">
                            <li [class.active]="activeInvoice.percentage_flag == 0">
                              <a (click)="activeInvoice.percentage_flag = 0;activeInvoice.discount=0.00;
                                 calculateInvoice()">
                                Flat ({{mysymbols}})
                              </a>
                              <!--activeInvoice.discount=0.00;activeInvoice.percentage_flag = 0;-->
                            </li>
                            <li [class.active]="activeInvoice.percentage_flag == 1">
                              <a (click)="activeInvoice.discount=0.00;
                                activeInvoice.percentage_flag=1;
                                calculateInvoice()">
                                Percent (%)
                              </a>
                            </li>
                          </ul>
                        </div>
                        <div *ngIf="activeInvoice.percentage_flag == 0" class="inline font-custom" style="margin-right: 2px;margin-left: -18px;">
                          ({{mysymbols}})
                        </div>


                        
                        <div *ngIf="activeInvoice.percentage_flag == 1" style="margin-right: 0px !important;margin-left: -18px;" class="inline font-custom">(%)</div>

                      </div>

                      <div class="col-8 pr-0">
                        <form #form_discount="ngForm" name="form_discount">
                          <div class="input-group addon-input">
                            <input type="number" id="percentage_input" name="percentage_input"
                              class="col-3 form-control" *ngIf="activeInvoice.percentage_flag == 1" min="1" max="5"
                              [(ngModel)]="activeInvoice.percentage_value" (keyup)="calculateInvoice()"
                              (ngModelChange)="dataChanged($event)" onfocus="this.select()" style="color: #aaaaaa;" />
                            <input type="number" id="discount_input" name="discount_input" class="col-3 form-control"
                              min="0.00" [max]="100" step="any" *ngIf="activeInvoice.percentage_flag == 0"
                              [(ngModel)]="activeInvoice.discount" (keyup)="calculateInvoice()" style="margin-right: 20px;"
                              onfocus="this.select()" />

                            <input type="number" id="discount_input" name="discount_input"
                              class="form-control height_40 dis_tax_label col-9" placeholder="00.000"
                              [(ngModel)]="activeInvoice.discount" (keyup)="calculateInvoice()"
                              readonly />
                            <div class="input-group-addon pr-0 remove-button">
                              <div class="addon selector" (click)="activeInvoice.discount_on_item=2;activeInvoice.percentage_flag=0;
                                activeInvoice.percentage_value=0;activeInvoice.discount=0;calculateInvoice();
                                activeInvoice.amount=activeInvoice.gross_amount;
                                balance=activeInvoice.gross_amount">
                                <!--activeInvoice.tax_amount-->
                                <img src="assets/images/grey_cross.png" Title="Delete" alt=""
                                  class="img_hover hg_20 cross_label_img">
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                    <!-- tax -->
                    <div class="row mr_right mr_0" *ngIf="activeInvoice.tax_on_item === 1">
                        <div class="col-4 discount-tax-label pr-0">
                          <span style="text-align: left;vertical-align: bottom;">
                              Tax (%)
                          </span>
                        </div>
                      
                        <div class="col-8 pr-0">
                          <form #form_discount="ngForm" name="form_discount">
                            <div class="input-group addon-input">
                                <input type="number" id="tax_input" name="tax_input" class="form-control col-3"
                                step="any"min="0.00" max="100" required style="color: #aaaaaa;margin-right: 20px;"
                                [(ngModel)]="activeInvoice.tax_rate" (keyup)="calculateInvoice()" onfocus="this.select()"
                              />
                              <input type="number" id="tax_inputs" name="tax_inputs" class="col-9 form-control height_40 dis_tax_label" 
                              placeholder="00.000" [(ngModel)]="activeInvoice.tax_amount" (keyup)="calculateInvoice()"
                            />
                              <div class="input-group-addon pr-0 remove-button">
                                <div class="addon selector" (click)="activeInvoice.tax_on_item = 2;activeInvoice.tax_rate = 0; activeInvoice.tax_amount = 0;calculateInvoice()">
                                  <!--activeInvoice.tax_amount-->
                                  <img src="assets/images/grey_cross.png" Title="Delete" alt="" class="img_hover hg_20 cross_label_img">
                                </div>
                              </div>
                            </div>
                          </form>
                        </div>
                      </div>

                    <!-- Tax list -->
                    <div class="row mr_right mr_0" *ngFor="let tax of activeInvoice.taxList; let taxIndex = index">
                      <div class="col-4 discount-tax-label pr-0 " *ngIf="tax">
                        <div style="text-align: left;vertical-align: bottom;">
                          <div class="d-inline font-custom">{{tax.taxName}} (%)</div>
                        </div>
                      </div>

                      <div class="col-8 pr-0" *ngIf="tax">
                        <form #form_tax_input="ngForm" name="form_tax_input">
                          <div class="input-group pr-0 col-12">
                            <input type="number" id="tax_input_list{{taxIndex}}" name="tax_input" step="any" min="0.00"
                              max="100" class="form-control col-3"
                              style="color: #aaaaaa;margin-left: -15px;margin-right: 20px;" [(ngModel)]="tax.percentage"
                              (keyup)="calculateInvoice()" onfocus="this.select()" />
                            <input type="number" id="tax_input_list{{taxIndex}}" name="tax_Listinput"
                              class="col-9 form-control height_40 dis_tax_label"
                              [(ngModel)]="tax.calculateValue" (keyup)="calculateInvoice()"
                              style="margin-right: -5px;" readonly />

                            <!-- <div class="input-group-addon set-color">%</div>-->
                            <div class="input-group-addon pr-0 remove-button">
                              <div class="addon selector"
                                (click)="activeInvoice.taxList[taxIndex] = null;calculateInvoice()">
                                <img src="assets/images/grey_cross.png" Title="Delete" class="img_hover hg_20 cross_label_img">
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>

                    <!-- Shipping -->
                    <div class="row mr_right mr_0" *ngIf="noShippingCharges">
                      <div class="col-4 discount-tax-label ">
                        <div style="text-align: left;vertical-align: bottom;">
                          {{settings.shipping ? settings.shipping : 'Shipping'}}(+)
                        </div>
                      </div>

                      <div class="col-8 pr-0">
                        <form #form_shipping_input="ngForm" name="form_shipping_input">
                          <div class="input-group pr-0">
                            <input type="number" name="shipping_input" class="form-control" min="0.00" step="any"
                              [max]="activeInvoice.gross_amount" required onclick="this.select()"
                              style="margin-right: -4px;" [(ngModel)]="activeInvoice.shipping_charges"
                              (keyup)="calculateInvoice()" placeholder="0" />

                            <div class="input-group-addon pr-0 remove-button">
                              <div class="addon selector padr0"
                                (click)="activeInvoice.shipping_charges = undefined;noShippingCharges = false;calculateInvoice()">
                                <img src="assets/images/grey_cross.png" Title="Delete" alt=""
                                  class="hg_20 cross_label_img img_hover">
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>

                    <!-- Adjustment -->
                    <div class="row mr_right mr_0"
                      *ngIf="activeInvoice.adjustment !== null && activeInvoice.adjustment !== undefined">
                      <div class="col-4 discount-tax-label pr-0 ">
                        <div style="text-align: left;vertical-align: bottom;">
                          {{settings.adjustment ? settings.adjustment : 'ADJ_LABEL' | translate}} (-)
                        </div>
                      </div>

                      <div class="col-8 pr-0">
                        <form #form_tax_input="ngForm" name="form_tax_input">
                          <div class="input-group pr-0">
                            <input type="number" name="tax_input" class="form-control" style="margin-right: -4px;"
                              step="any" required onfocus="this.select()" placeholder="0"
                              [(ngModel)]="activeInvoice.adjustment"
                               (keyup)="calculateInvoice()" /> 
                               <!-- (change)=setTwoNumberDecimal(activeInvoice.adjustment) // removed this function-->

                            <!-- <div class="input-group-addon set-color">%</div>-->
                            <div class="input-group-addon pr-0 remove-button">
                              <div class="addon selector"
                                (click)="activeInvoice.adjustment = undefined;noAdjustment = false; calculateInvoice()">
                                <img src="assets/images/grey_cross.png" Title="Delete" class="hg_20 cross_label_img img_hover">
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>

                    <!-- Gross Total -->
                    <div class="col-12 term-cond-label">
                      <div class="row">
                        <div class="col-6 text-left">
                          <span class="font-custom-bold">
                            {{settings.total ? settings.total : 'TOTAL_LABEL' | translate}}
                          </span>
                        </div>

                        <div *ngIf="activeInvoice" class="col-6 text-right">
                          <span class="font-custom-bold price">
                            {{activeInvoice.amount | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- Paid Amount -->
                    <div class="paidBackground">
                      <div class="row mx-0 paid_border" style="padding-bottom: 6px;">

                        <div class="col-6 text-left" style="margin-top: 6px;">
                          <span class="font-custom">{{settings.paid ? settings.paid : 'PAID_LABEL' | translate}}
                          </span>
                          <a class="paidArrow fa fa-angle-down pay_arrow"[ngClass]="{'disable_toggle':activeInvoice.balance == undefined}" (click)="openAddPaymentModal()" data-toggle="collapse" href="#collapseExample" role="button"
                              aria-expanded="false" aria-controls="collapseExample">
                            </a>
                        </div>
                        <div class="col-6 text-right" style="padding-right: 10px !important;margin-top: 6px;">
                          <span
                            class="font-custom price">{{amountPaid | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}</span>
                        </div>
                        
                        <div class="row mx-0" style="margin-bottom: -15px;width: 100%;">
                          <div class="collapse" id="collapseExample" style="width: 100%;"> 
                            <div class="pay_mrg">
                              <div *ngFor="let item of activeInvoice.payments; let i = index">
                                <div class="row mx-0" style="margin-bottom: 10px;">
                                  <div class="col-6 text-left label_color">
                                    <span class="font-custom">{{item.date_of_payment | date}}</span>
                                    <span *ngIf="!item.date_of_payment" class="font-custom">{{formatedDate | date}}</span>
                                  </div>
                                  <div class="col-6 text-right pad_rg_5" style="margin-top: 6px;">
                                    <span
                                      class="font-custom price">{{item.paid_amount | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}
                                    </span>
                                    <img src="assets/images/grey_cross.png" (click)="deleteInstallment(i)" Title="Delete" alt=""
                                      class="hg_20 cross_label_img img_hover">
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="row mx-0 payment_row installment_mrg">
                              <div class="row installment_mrg">
                                <div class="col-4">
                                  <input type="text" id="addPaymentDate12" style="width: 140px;" name="paymentDate" class="form-control" placeholder="mm/dd/yyyy"
                                  [formControl]="paymentDate" matInput [matDatepicker]="picker2" (click)="picker2.open()" required readonly>
                                <mat-datepicker #picker2 style="z-index: 8000"></mat-datepicker>
                              </div>
                              <div class="col-5">
                                  <input type="number" id="paymentAmount2" name="paymentAmount" onclick="this.select()"
                                  class="form-control default-height" min="0.00" [max]="addPaymentModal.balance"
                                  [(ngModel)]="addPaymentModal.paid_amount"
                                  placeholder="Add {{settings.mTvAmount ? settings.mTvAmount : 'Amount'}} {{settings.paid ? settings.paid : 'Paid'}}" style="width: 190px;font-size: 13px;" />
                              </div>
                              <div class="col-3">
                                <button type="button" class="btn btn-custom-1 pull-right addPaid_btn" (click)="addPaymentInModalPaymentList();">
                                  Add
                                </button>
                              </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Balance -->
                    <div class="col-12 balance-row">
                      <div class="row mx-0">
                        <div class="col-6 text-left" style="margin-left: -12px;">
                          <span class="bld">{{settings.balance ? settings.balance : 'BAL_LABEL' | translate}}</span>
                        </div>
                        <div class="col-6 text-right">
                          <span class="bld price"
                            style="margin-right: -25px !important;">{{activeInvoice.balance | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}</span>
                        </div>
                      </div>
                    </div>

                    <!-- Payment and Save buttons -->
                    <div class="col-12 px-0 mt-2">
                      <!-- <button type="button" title="ADD PAYMENT" [disabled]="activeInvoice.balance == 0"
                        class="btn_width_auto change_bg btn btnd btn-custom-1 btn-raised pull-left"
                        (click)="openAddPaymentModal()" style="width: auto !important;">
                        Add Payment
                      </button> -->
                      <button type="submit" id="invSubmitBtn" 
                        class="save btn save_btn btn-raised width25btn pull-right"
                        data-loading-text="Saving..<i class='fa fa-spinner fa-spin '></i>">
                        Save
                      </button><!--[disabled]="activeInvoice.listItems?.length == 0"-->
                      <button type="submit" *ngIf="edit" [disabled]="activeInvoice.listItems?.length == 0"
                        class="btn btnd btn-custom-2 no-border-radius pull-right ml-2 width12perbtn"
                        style="margin-right: 8px;" (click)="deleteInvoice()">
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      
      <!-- Previous Invoices Button -->
      <div class="col-12 col-md-3 search_div">
        <div class="row" style="margin: 0 auto;">
          
          <button type="button" style="padding: 14px;" class="col-12 side_btn btn btnd btn-custom-2 no-border-radius"
            (click)="router.navigate(['/invoice/view'])">Search For Invoices
            <img src="assets/images/search_new.png" alt="logo" style="width: 14px;">
          </button>
          <!-- Previous Invoices Button ends -->
          <div class="col-1"></div>
        </div>
        <div class="row" style="margin: 0 auto;">
          <button *ngIf="viewTodaysInvoice == true || edit" type="button"
            class="col-12 btn btnd btn-custom-2 no-border-radius side_btn add_invoice"
            (click)="addNewInvoice()">Add New Invoice
            <i class="fa fa-plus" style="padding: 12px 0px"></i>
          </button>
        </div>
        <!-- recently added invoice -->
        <div *ngIf="invoiceList" class="row" style="margin-top: 14px;">
          <div
            class="col-sm-12 col-md-12 col-xs-12 col-lg-12 back-add-list text-center list-header-col font-custom-bold"
           >
            {{settings.mTvInvoice ? settings.mTvInvoice : 'Invoices'}} Generated Today
          </div>

          <div class="col-12 px-0 mCustomScrollbar style-3" style="overflow-y: auto !important;">

            <div [ngClass]="{'item': true, 'row': true, 'selected': (invoice.unique_identifier == invoiceId)}"
              *ngFor="let invoice of recentInvoiceList" class="row side_item_height"  (click)="goView(invoice.unique_identifier)">
              <div class="col-2 list-date font-custom-bold fontsize13 hr_line" style="line-height: 16px;">
                <span style="font-size: 18px;">{{ invoice.created_date | date: 'dd' }}</span><br/>
                <span class="sub_date">{{ invoice.created_date | date: 'MMM' }}</span>
              </div>
              <div class="col-10">
                <div class="row" style="line-height: 7px;">
                  <div class="col-12" style="padding: 3px 4px 0px 14px;">
                    <h5 class="fontsize13" style="font-family: helvetica_regular !important;
                    font-size: 14px !important;">{{ getClientName(invoice.unique_key_fk_client) }}</h5>
                  </div>
                  <div class="col-5 today_txt">
                    {{ invoice.invoice_number }}
                  </div>
                  <div class="col-6 text-right fontsize12 today_txt">
                    {{ invoice.amount | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2' }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- ends -->

        <!-- Delete Invoices Button -->
        <!-- <button type="button" class="btnd add-line-item-button" *ngIf="edit" (confirm)="deleteInvoice()"
          [swal]="{ title: 'Are you sure want to delete Invoice?', type: 'warning', showCancelButton: true,
            confirmButtonColor: '#DD6B55', confirmButtonText: 'Yes, delete it!' }
          "
        >
          Delete Invoices
        </button> -->
      </div>
    </div>
  </div>
</div>

<!-- ADD CLIENT MODAL -->
<div id="add-client" class="modal fade" role="dialog" aria-labelledby="clientFormLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title form-header font-custom-bold header-color" id="clientFormLabel">
          Add New Client
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <img src="assets/images/cross16.png" alt="logo" class="img_hover">
        </button>
      </div>
      <div class="modal-body">
        <form class="form-horizontal add-client-form" name="clientform" #clientform="ngForm">
          <div class="col-12">
            <div class="row">
              <div class="col-6" style="padding-right: 23px;">
                <div class="form-group" [class.has-error]="(clientform.submitted && clientform.errors)">
                  <input type="text" name="name" tabindex="-1" class="form-control add-client-input-custom"
                    [(ngModel)]="addClientModal.name" placeholder="Organization Name" required />
                  <!-- <div class="form-error" *ngIf="(clientform.submitted && clientform.errors)">
                    <span *ngIf="clientform.name.$error.required">Required</span>
                    <span *ngIf="errors">{{ errors.name[0] }}</span>
                  </div> -->
                </div>
              </div>

              <div class="col-6" style="padding-left: 23px;">
                <div class="form-group " [class.has-error]="(clientform.submitted && clientform.errors)">
                  <input type="text" name="contactPersonName" class="form-control add-client-input-custom"
                    [(ngModel)]="addClientModal.contactPersonName" placeholder="Contact Person"
                    onfocus="this.select()" />
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="row">
              <div class="col-6" style="padding-right: 23px;">
                <div class="form-group " [class.has-error]="(clientform.submitted && clientform.errors)">
                  <input type="text" [(ngModel)]="addClientModal.email" name="email"
                    class="form-control add-client-input-custom" placeholder="Email" onfocus="this.select()" my-enter-in
                    select-on-click />
                </div>
              </div>
              <div class="col-6" style="padding-left: 23px;">
                <div class="form-group" [class.has-error]="(clientform.submitted && clientform.errors)">
                  <input type="text" [(ngModel)]="addClientModal.number" name="cont_number"
                    class="form-control add-client-input-custom" placeholder="Number" onfocus="this.select()"
                    my-enter-in select-on-click />
                </div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="form-group add-client-input-width"
              [class.has-error]="(clientform.submitted && clientform.errors)">
              <textarea elastic [(ngModel)]="addClientModal.addressLine1" name="addressLine1"
                class="form-control mCustomScrollbar style-3" placeholder="Address" style="overflow-y: auto !important;height: 69px !important;"
                onfocus="this.select()"></textarea>
            </div>
          </div>

          <div class="col-12">
            <div class="form-group add-client-input-width"
              [class.has-error]="(clientform.submitted && clientform.errors)">
              <textarea elastic [(ngModel)]="addClientModal.shippingAddress" name="shippingAddress"
                class="form-control mCustomScrollbar style-3" placeholder=" Shipping Address"
                style="height: 69px !important;overflow-y: auto !important" onfocus="this.select()"></textarea>
            </div>
          </div>

          <div class="col-12">
            <div class="form-group add-client-input-width">
              <input type="text" [(ngModel)]="addClientModal.businessId" name="businessId"
                class="form-control add-client-input-custom" placeholder="Business Id " onfocus="this.select()" />
            </div>
          </div>

          <div class="col-12">
            <div class="form-group add-client-input-width">
              <input type="text" [(ngModel)]="addClientModal.businessDetail" name="businessDetail"
                class="form-control add-client-input-custom" placeholder="Business Detail" onfocus="this.select()" />
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-raised btn-custom-1 width20btn" (click)="closeAddClientModal()">
          Close
        </button>
        <button type="button" id="saveClientButton" class="btn  btn-raised  btn-success width20btn"
          data-loading-text="Saving..<i class='fa fa-spinner fa-spin '></i>" [disabled]="!clientform.valid"
          (click)="saveClient(clientform.valid)">
          Add Client
        </button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT ITEM MODAL -->
<div id="edit-item" class="modal fade" role="dialog" aria-labelledby="clientFormLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title form-header font-custom-bold header-color" id="clientFormLabel">
          Edit Item
        </h4>
        <button type="button" class="close" aria-label="Close" (click)="closeItemModel()">
          <img src="assets/images/cross16.png" alt="logo" class="img_hover">
        </button>
      </div>
      <div class="modal-body">
        <form class="form-horizontal add-client-form" name="itemform" #itemform="ngForm">
          <input type="hidden" name="uid" onfocus="this.select()" [ngModel]="activeItem.unique_identifier">
          <div class="row">
            <div class="col-12">
              Name:
              <input type="text" name="name" class="form-control add-client-input-custom"
                [ngModel]="activeItem.product_name" placeholder="Name" onfocus="this.select()" required disabled />
            </div>

            <div class="col-12">
              Description:
              <textarea [(ngModel)]="activeItem.description" name="description"
                class="form-control mCustomScrollbar style-3" placeholder="Description" onfocus="this.select()"
                select-on-click style="height: 69px !important;overflow-y: auto !important"></textarea>
            </div>

            <div class="col-12">
              Quantity (*):
              <input type="number" name="quantity" class="form-control add-client-input-custom"
                [(ngModel)]="activeItem.quantity" (keyup)="calculateTotal()" onfocus="this.select()" required
                placeholder="Quantity" my-enter-in select-on-click />
            </div>

            <div class="col-12">
              {{settings.mTvRate ? settings.mTvRate : 'Rate'}} (*):
              <input type="number" name="rate" class="form-control add-client-input-custom"
                [(ngModel)]="activeItem.rate" (keyup)="calculateTotal()"
                placeholder="{{settings.mTvRate ? settings.mTvRate : 'Rate'}}" onfocus="this.select()" required />
            </div>

            <div class="col-12" *ngIf="settings.taxFlagLevel === 0">
              Tax:
              <input type="number" name="tax-rate" class="form-control add-client-input-custom" min="0" max="100"
                [(ngModel)]="activeItem.tax_rate" (keyup)="calculateTotal()" placeholder="Tax"
                onfocus="this.select()" />
            </div>

            <div class="col-12" *ngIf="settings.discountFlagLevel === 1">
              {{settings.discount ? settings.discount : 'Discount'}}:
              <input type="number" name="discount" class="form-control add-client-input-custom"
                [(ngModel)]="activeItem.discount" (keyup)="calculateTotal()" placeholder="{{settings.discount}}"
                onfocus="this.select()" />
            </div>

            <div class="col-12">
              {{settings.total ? settings.total : 'Amount'}}:
              <input type="number" [ngModel]="activeItem.total" name="total" placeholder="quantity" disabled
                class="form-control add-client-input-custom" onfocus="this.select()" />
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-raised save_btn btn-custom-1 width20btn" (click)="closeItemModel()">
          Close
        </button>
        <button type="button" id="saveClientButton" style="border-radius: 1px;" class="btn change_bg btn-success width20btn"
          [disabled]="!itemform.valid" (click)="addEditInvoiceItem(itemform.controls.uid.value)">
          Edit Item
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ADD TERMS MODAL -->
<div id="add-terms" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-md term_popup_modal" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="add_term_title modal-title form-header header-color font-custom-bold" id="addPaymentLabel">
           {{settings.mTvTermsAndConditions ? settings.mTvTermsAndConditions : 'Terms and Conditions'}}
        </div>
        <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <img src="assets/images/cross16.png" alt="logo" class="img_hover">
        </button> -->
      </div>

      <div class="modal-body term_modal_body">
        <h5 class="modal-title form-header header-color font-custom-bold h5_terms_border" style="height: 70px;" id="addPaymentLabel">
          <form name="termForm" #termForm="ngForm">
            <div class="row">
              <div class="col-1">
                <label class="check">
                  <div class="checkbox default_checkbox">
                    <input type="checkbox" (change)="changeCheckbox()" [(ngModel)]="defaultChecked" id="addtermcheck" name="setDefault"
                      class="ng-pristine ng-valid ng-touched modal-checkbox" onfocus="this.select()">
                    <span class="checkmark default_checkbox_span"></span>
                  </div>
                </label>
                <div class="default_text">Make<br /> Default</div>
              </div>
              <div class="col-10">
                <textarea name="term" class="mCustomScrollbar style-3 add_term_input textarea_term" [(ngModel)]="addTermModal.terms" placeholder="Add term & Condition"
                  onfocus="this.select()" required elastic></textarea>
              </div>
              <div class="col-1">
                
                <button type="button" id="addtermbtn" [ngClass]="{'add_disable': !termForm.valid }" name="addtermbtn" title="save"
                  class="btn add_term_btn btn-raised pull-right ml-2 add_to_list_btn term_col1"
                  (click)="saveTerm(termForm.valid)">
                  <i class="fa fa-plus add_plus"></i><br /> <p style="font-size: 11px !important;">Add To List</p>
                </button>
              </div>
            </div>
            
          </form>
        </h5>

        <div class="row terms_border">
          <div class="col-12 mCustomScrollbar style-3" style="max-height: 290px;">
            <div class="item termlist row product-list" id="term1{{index}}"
              *ngFor="let term of termList | orderBy: 'term':'desc'; let index = index"
              [class.selected]="selectedTerm == index">
              <div class="col-12 px-0">
                <div class="row">
                  <div class="col-md-1 px-0">
                    
                    <label class="check">
                      <div class="col-1">
                        <input type="checkbox" id="termcheck{{index}}" name="term" style="margin-left: 5px;"
                          (change)="addRemoveTermsFromInvoice(term)" [checked]="isTermInInvoice(term)" />
                        <span class="checkmark"></span>
                      </div>
                    </label>
                  </div>
                  <div class="col-md-9 pl-0">
                    <span style="vertical-align: top;word-break: break-all;"> {{term.terms}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer item-form">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
         Cancel
        </button>
        <button type="submit" class="save btn save_btn btn-raised width25btn pull-right" data-dismiss="modal"
          aria-label="Close">
          Done
        </button>
      </div>
    </div>
  </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal fade" id="addPaymentAddInvoice" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog add-payment-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title form-header header-color font-custom-bold" id="addPaymentLabel12">
          Add Payment
        </h4>
        <a class="pull-right" (click)="closeAddPaymentModal()" style="margin-top: 6px;">
          <img src="assets/images/cross16.png" alt="logo" class="img_hover">
        </a>
      </div>
      <div class="modal-body">
        <div class="col-12 px-0 add-payment" style="margin-bottom: 10px;">
          <div class="row">
            <div class="col-4 col-md-5">
              <form name="innerform1" #innerform1="ngForm">
                <div class=" form-group payment-input">
                  <div class="input-group" style="width: 100%">
                    <input type="number" id="paymentAmount2" name="paymentAmount" onclick="this.select()"
                      class="form-control default-height" min="0.00" [max]="addPaymentModal.balance"
                      [(ngModel)]="addPaymentModal.paid_amount"
                      placeholder="Add {{settings.mTvAmount ? settings.mTvAmount : 'Amount'}} {{settings.paid ? settings.paid : 'Paid'}}">
                    <!-- <div class="form-error">
                      <span *ngIf="innerform1.controls.paymentAmount.error.max">Should be Less than Balance</span>
                    </div> -->
                  </div>
                </div>
              </form>
            </div>

            <div class="col-2 pl-0" style="margin-left: -6px;">
              <button class="btn btn-info btn-circle" (click)="addPaymentInModalPaymentList()"
                [disabled]="!addPaymentModal.paid_amount || addPaymentModal.paid_amount > addPaymentModal.balance">
                <i class="fa fa-plus"></i>
              </button>
            </div>

            <div class="col-6 col-md-5 pl-0">
              <input type="text" id="addPaymentDate12" name="paymentDate" class="form-control" placeholder="mm/dd/yyyy"
                [formControl]="paymentDate" matInput [matDatepicker]="picker2" (click)="picker2.open()" required
                readonly>
              <mat-datepicker #picker2 style="z-index: 8000"></mat-datepicker>
            </div>
          </div>
        </div>

        <div class="row mx-0 payment_modal_pg" style="background: #e0dede !important;">
          <div class="col-12">
            <div class="font-custom-bold float-left">
              {{settings.mTvInvoice ? settings.mTvInvoice : 'Invoice'}}
            </div>
            <div *ngIf="addPaymentModal" class="font-custom-bold float-right price">
              {{ addPaymentModal.amount | currency:settings.currencyInText:'symbol':'1.2-2' }}
            </div>
          </div>
        </div>

        <div class="top_bot_mr_10">
          <div class="row mx-0">
            <div class="col-6 text-left">
              <span class="font-custom">{{settings.paid ? settings.paid : 'PAID_LABEL' | translate}}</span>
            </div>
            <div  *ngIf="activeInvoice" class="col-6 text-right" style="padding-right: 23px !important;">
              <span
                class="font-custom price">{{(activeInvoice.amount - activeInvoice.balance) | currency:settings.currencyInText:(settings.currencyText ? 'code' : 'symbol'):'1.2-2'}}</span>
            </div>
          </div>
        </div>
        <hr style="margin-bottom: 0px !important;">

        <div class="row mx-0 payment_modal_pg" *ngFor="let payment of addPaymentModal.payments; let i = index;">
          <div class="col-12 label_color">
            <div class="pull-left" style="border-top: none;">
              {{payment.date_of_payment | date}}
            </div>
            <div *ngIf="!payment.date_of_payment" class="pull-left" style="border-top: none;">
              {{formatedDate | date}}
            </div>
            <div class="pull-right price" style="border-top: none;">
              {{payment.paid_amount | currency:settings.currencyInText:'symbol':'1.2-2'}}
              <!-- <img src="assets/images/grey_cross.png" (click)="deleteInstallment(i)" Title="Delete" alt="" class="hg_20 cross_label_img"> -->
            </div>
          </div>
        </div>

        <div class="row mx-0 payment_modal_pg" style="background: #e0dede !important; margin-top: 5px">
          <div class="col-12">
            <div class="font-custom-bold pull-left">
              {{settings.balance ? settings.balance : 'Balance'}} Due
            </div>
            <div class="font-custom-bold pull-right price">
              {{ addPaymentModal.balance | currency:settings.currencyInText:'symbol':'1.2-2'}}
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="col-12 px-0">
          <button type="button" class="btn btn-raised btn-custom-2 pull-left margin-right--15"
            (click)="addPaymentModal.paid_amount = addPaymentModal.balance" [disabled]="addPaymentModal.balance == 0">
            Full Payment
          </button>
          <button type="button" (click)="addPaymentsInInvoice()"
            class="btn btn-success btn-raised font-custom pull-right width20btn">
            Done
          </button>
          <button type="button" class="btn btn-raised btn-custom-1 width20btn pull-right"
            (click)="closeAddPaymentModal()" style="margin-right: 12px;">
            Cancel
          </button>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error MODAL starts -->
<div id="error-message" class="modal fade" role="dialog" aria-labelledby="clientFormLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog mod_dialog">
    <div class="modal-content mod_content">
      <div class="modal-header mod_header">
        <img class="center" src="assets/images/connection_lost.png" alt="logo" class="center error_logo">
      </div>
      <div class="modal-body">
        <h3 class="title">Connection Lost !</h3>
        <p class="error_logo">Make sure your wifi or cellular data is turned on and try again
          !!!</p>
      </div>
      <div class="modal-footer mod_footer">
        <button type="button" class="mod_close_btn btn save_btn btn-raised width25btn center"
          data-dismiss="modal" aria-label="Close">
          OK
        </button>

      </div>
    </div>
  </div>
</div>
<!-- Error MODAL ends -->